(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{471:function(s,t,n){s.exports=n.p+"assets/img/webapplication_efcore.0b32d52c.png"},472:function(s,t,n){s.exports=n.p+"assets/img/webapplication_efcore2.00c52aee.png"},518:function(s,t,n){"use strict";n.r(t);var a=n(2),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("è¿™æ˜¯è¯¥ç³»åˆ—çš„ç¬¬äº”ç¯‡æ–‡ç« ï¼š"),t("RouterLink",{attrs:{to:"/blogs/2022/exploring-dotnet-6/"}},[s._v("æ¢ç´¢ .NET 6")]),s._v("ã€‚")],1),s._v(" "),t("p",[s._v("åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä¸€ç›´ä¸“æ³¨äºä½¿ç”¨ "),t("code",[s._v("WebApplication")]),s._v(" å’Œ "),t("code",[s._v("WebApplicationBuilder")]),s._v(" æ„å»ºçš„æ–°æœ€å°æ‰˜ç®¡ APIã€‚å®ƒä»¬ä¸ºæ„å»º Web åº”ç”¨æä¾›äº†æ›´ç®€å•çš„æ¨¡å‹ï¼ŒåŒæ—¶ä¿æŒäº†ä¸ .NET Core 3.x/5 çš„åŸºäºé€šç”¨ä¸»æœºåº”ç”¨ç¨‹åºç›¸åŒçš„æ•´ä½“åŠŸèƒ½ã€‚")]),s._v(" "),t("p",[s._v("ç„¶è€Œï¼Œè¿™ç§ç®€åŒ–ä¹Ÿå­˜åœ¨æŒ‘æˆ˜ã€‚æ—©æœŸç‰ˆæœ¬ä¸­æ›´å¤æ‚çš„å¯åŠ¨ä»£ç ï¼ˆé€šå¸¸åœ¨ "),t("em",[s._v("Program.cs")]),s._v(" å’Œ "),t("em",[s._v("Startup")]),s._v(" ä¹‹é—´æ‹†åˆ†ï¼‰å…·æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¼—æ‰€å‘¨çŸ¥çš„é’©å­ï¼Œå·¥å…·å¯ä»¥ä½¿ç”¨è¿™äº›é’©å­æ¥åŠ«æŒåº”ç”¨ç¨‹åºå¯åŠ¨è¿›ç¨‹ã€‚")]),s._v(" "),t("p",[s._v("è¿™æ–¹é¢çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹æ˜¯ "),t("a",{attrs:{href:"https://github.com/dotnet/efcore/blob/v6.0.0-rc.1.21452.10/src/EFCore.Design/Design/Internal/DbContextOperations.cs",target:"_blank",rel:"noopener noreferrer"}},[s._v("EF Core å·¥å…·"),t("OutboundLink")],1),s._v("ã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ EF Coreï¼Œä½ å¯èƒ½ç†Ÿæ‚‰å°è¯•æ›´æ”¹å¯åŠ¨ä»£ç æ—¶å‡ºç°çš„é—®é¢˜ã€‚å› æ­¤ï¼Œå½“æ¡†æ¶æ›´æ”¹å…¶é»˜è®¤å¯åŠ¨ä»£ç æ—¶ï¼Œæ‚¨å°±çŸ¥é“å®ƒä¼šå¯¼è‡´é—®é¢˜ï¼")]),s._v(" "),t("h2",{attrs:{id:"asp-net-core-3-x-5-ä¸­çš„-ef-core-å·¥å…·"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#asp-net-core-3-x-5-ä¸­çš„-ef-core-å·¥å…·"}},[s._v("#")]),s._v(" ASP.NET Core 3.x/5 ä¸­çš„ EF Core å·¥å…·")]),s._v(" "),t("p",[s._v("EF Core åŒ…å«ç”¨äºç”Ÿæˆè¿ç§»å’Œé’ˆå¯¹æ•°æ®åº“è¿è¡Œè¿ç§»çš„å„ç§å·¥å…·ï¼Œä½†è¦æ‰§è¡Œæ­¤æ“ä½œï¼Œå®ƒéœ€è¦äº†è§£æ‚¨çš„ä»£ç ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œå®ƒéœ€è¦èƒ½å¤Ÿè¿è¡Œåº”ç”¨ç¨‹åºçš„å¯åŠ¨ä»£ç ï¼Œä»¥ä¾¿ä½¿ç”¨æ‚¨é…ç½®çš„æ‰€æœ‰é…ç½®å’Œä¾èµ–å…³ç³»æ³¨å…¥æœåŠ¡ã€‚")]),s._v(" "),t("p",[s._v("åœ¨ä»¥å‰ç‰ˆæœ¬çš„ ASP.NET Core ä¸­ï¼ŒEF Core æŒ‚æ¥åˆ° "),t("code",[s._v("Program")]),s._v(" ç±»ä¸­çš„ "),t("code",[s._v("CreateWebHostBuilder")]),s._v(" æˆ– "),t("code",[s._v("CreateHostBuilder")]),s._v(" æ–¹æ³•ä¸­ã€‚"),t("a",{attrs:{href:"https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-5.0",target:"_blank",rel:"noopener noreferrer"}},[s._v('EF Core å·¥å…·å°†å¯»æ‰¾è¿™ç§"ç¥å¥‡"æ–¹æ³•'),t("OutboundLink")],1),s._v("æ¥è®¿é—®ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºçš„ "),t("code",[s._v("IWebHostBuilder")]),s._v(" æˆ– "),t("code",[s._v("IHostBuilder")]),s._v("ã€‚")]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("IHostBuilder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateHostBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v("\n    Host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateDefaultBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ConfigureWebHostDefaults")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webBuilder "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            webBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("UseStartup")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Startup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("blockquote",[t("p",[s._v("è¿™æ€»æ˜¯æ„Ÿè§‰å¾ˆç¬¨æ‹™;å¦‚æœé‡å‘½åäº†è¯¥æ–¹æ³•æˆ–æ›´æ”¹äº†å…¶ç­¾åï¼Œåˆ™ EF Core å·¥å…·å°†ä¸­æ–­ã€‚")])]),s._v(" "),t("p",[s._v("é€šè¿‡ä½¿ç”¨è¿™ç§ä¼—æ‰€å‘¨çŸ¥çš„æ–¹æ³•ï¼ŒEF Core å·¥å…·å¯ä»¥ä½¿ç”¨åå°„åŠ è½½åº”ç”¨ç¨‹åºçš„ç¨‹åºé›†ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè·å–è¿”å›çš„ "),t("code",[s._v("IHostBuilder")]),s._v("ï¼Œåœ¨å…¶ä¸Šè°ƒç”¨ "),t("code",[s._v("Build")]),s._v(" ä»¥åˆ›å»º "),t("code",[s._v("IHost")]),s._v("ï¼Œç„¶åä» "),t("code",[s._v("IHost.Services")]),s._v(" å±æ€§ä¸­è·å– "),t("code",[s._v("IServiceProvider")]),s._v("ï¼ä»æ­¤æä¾›å•†å¤„ï¼ŒEF Core å‡ ä¹å¯ä»¥å†…è§‚æœ‰å…³åº”ç”¨ç¨‹åºçš„ä»»ä½•å†…å®¹ã€‚éå¸¸æ¼‚äº®ï¼Œä½†éå¸¸ä¾èµ–äºç‰¹å®šçš„çº¦å®šã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:n(471),alt:"The EF Core tools run your application using reflection to retrieve an IServiceProvider"}})]),s._v(" "),t("p",[s._v("é‚£ä¹ˆï¼Œå½“ ASP.NET Core åœ¨ .NET 6 ä¸­ç”¨æœ€å°‘çš„æ‰˜ç®¡ API æŠ›å¼ƒæ‰€æœ‰è¿™äº›çº¦å®šæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå¥½å§ï¼Œ"),t("a",{attrs:{href:"https://github.com/dotnet/aspnetcore/issues/31861",target:"_blank",rel:"noopener noreferrer"}},[s._v("EF Coreå·¥å…·åäº†"),t("OutboundLink")],1),s._v("ğŸ˜„")]),s._v(" "),t("h2",{attrs:{id:"net-6-ä¸­å¦‚ä½•æ”¯æŒ-ef-core-å·¥å…·"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#net-6-ä¸­å¦‚ä½•æ”¯æŒ-ef-core-å·¥å…·"}},[s._v("#")]),s._v(" .NET 6 ä¸­å¦‚ä½•æ”¯æŒ EF Core å·¥å…·")]),s._v(" "),t("p",[s._v("å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ï¼Œè¿™ç¯‡æ–‡ç« ç®€è¦ä»‹ç»äº†"),t("a",{attrs:{href:"https://github.com/dotnet/aspnetcore/issues/31861",target:"_blank",rel:"noopener noreferrer"}},[s._v("å¤§å«Â·ç¦å‹’æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡çš„"),t("OutboundLink")],1),s._v("ã€‚æ–¹æ³•æ˜¯ä»–åœ¨åº”ç”¨å¯åŠ¨æœŸé—´æ·»åŠ äº†æ–°çš„è¯Šæ–­æºäº‹ä»¶ï¼")]),s._v(" "),t("p",[s._v("å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ "),t("code",[s._v("DiagnosticSource")]),s._v(" å’Œ "),t("code",[s._v("DiagnosticListener")]),s._v("ï¼Œ"),t("a",{attrs:{href:"https://andrewlock.net/logging-using-diagnosticsource-in-asp-net-core/",target:"_blank",rel:"noopener noreferrer"}},[s._v("æˆ‘åœ¨è¿™é‡Œæœ‰ä¸€ç¯‡å…³äºå®ƒçš„ä»‹ç»æ€§æ–‡ç« "),t("OutboundLink")],1),s._v("ï¼Œå…¶ä¸­æè¿°äº†å®ƒä»¬åœ¨ .NET Core ä¸­å„ç§æ—¥å¿—è®°å½•åŸºå…ƒä¸­çš„é€‚ç”¨ä½ç½®ã€‚")]),s._v(" "),t("blockquote",[t("p",[s._v("è¿™ç¯‡æ–‡ç« ç°åœ¨å·²ç»è¶…è¿‡4å¹´äº†ï¼ˆ"),t("em",[s._v("å®ƒç”šè‡³åŒ…å«å¯¹ project.json çš„å¼•ç”¨ï¼")]),s._v("ï¼‰ï¼Œä½†å®ƒä»ç„¶æ˜¯è¯Šæ–­æºå¦‚ä½•å·¥ä½œçš„è‰¯å¥½å‚è€ƒã€‚")])]),s._v(" "),t("p",[t("code",[s._v("DiagnosticSource")]),s._v(" ä¸»è¦ç”¨ä½œè®°å½•ä¸°å¯Œæ•°æ®çš„é«˜æ€§èƒ½æ–¹æ³•ï¼Œç±»ä¼¼äº Windows äº‹ä»¶è·Ÿè¸ª ï¼ˆETWï¼‰ï¼Œä½†å®Œå…¨åœ¨è¿›ç¨‹ä¸­ã€‚é€šè¿‡å°† "),t("code",[s._v("DiagnosticSource")]),s._v(" äº‹ä»¶ä½œä¸ºä¸»æœºç”Ÿæˆè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†å‘å‡ºï¼ŒDavid ä¸º EF Core å·¥å…·æä¾›äº†ä¸€ç§è®¿é—® "),t("code",[s._v("IHostBuilder")]),s._v(" å’Œ "),t("code",[s._v("IHost")]),s._v(" å¯¹è±¡çš„æ–¹æ³•ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹æ–°äº‹ä»¶ï¼Œåœ¨åç»­éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° EF Core å·¥å…·å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚")]),s._v(" "),t("h2",{attrs:{id:"åœ¨ä¸»æœºç”Ÿæˆè¿‡ç¨‹ä¸­å‘å‡ºæ–°äº‹ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨ä¸»æœºç”Ÿæˆè¿‡ç¨‹ä¸­å‘å‡ºæ–°äº‹ä»¶"}},[s._v("#")]),s._v(" åœ¨ä¸»æœºç”Ÿæˆè¿‡ç¨‹ä¸­å‘å‡ºæ–°äº‹ä»¶")]),s._v(" "),t("p",[s._v("åœ¨æœ¬ç³»åˆ—çš„è¿‡å»ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å±•ç¤ºäº†æ–°çš„ "),t("code",[s._v("WebApplicationBuilder")]),s._v(" å’Œ "),t("code",[s._v("WebApplication")]),s._v(" åªæ˜¯å›´ç»• .NET Core 3.0 ä¸­å¼•å…¥çš„é€šç”¨ä¸»æœºçš„åŒ…è£…ã€‚å…¶ä»– "),t("code",[s._v("DiagnosticSource")]),s._v(" äº‹ä»¶å·²æ·»åŠ åˆ°é€šç”¨ "),t("code",[s._v("HostBuilder")]),s._v(" ä¸­ï¼Œå› æ­¤å®ƒä»¬æ—¢é€‚ç”¨äºæœ€å°ä¸»æœº "),t("code",[s._v("WebApplication")]),s._v('ï¼Œä¹Ÿé€‚ç”¨äº"ä¼ ç»Ÿ"é€šç”¨ä¸»æœºæ„é€ ã€‚')]),s._v(" "),t("blockquote",[t("p",[s._v("è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ .NET 6 ä¸­ç»§ç»­ä½¿ç”¨ "),t("em",[s._v("Program.cs")]),s._v(" å’Œ "),t("code",[s._v("Start")]),s._v(" æ‹†åˆ†ï¼Œå¹¶é‡å‘½å "),t("code",[s._v("CreateHostBuilder()")]),s._v(" æ–¹æ³•ï¼Œåˆ™ EF Core å·¥å…·å°†ä¸å†ä¸­æ–­ï¼")])]),s._v(" "),t("p",[s._v("ä¸‹é¢çš„ä»£ç æ¼”ç¤º "),t("code",[s._v("HostBuilder.Build()")]),s._v(" æ–¹æ³•ï¼ˆ"),t("a",{attrs:{href:"https://github.com/dotnet/runtime/blob/v6.0.0-rc.1.21451.13/src/libraries/Microsoft.Extensions.Hosting/src/HostBuilder.cs",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä» .NET 6 RC1 å¼€å§‹"),t("OutboundLink")],1),s._v("ï¼Œå‡ºäºå¯è¯»æ€§è€ƒè™‘ï¼‰ã€‚æ‰€åšçš„æ›´æ”¹ç›¸å¯¹ç®€å•ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨ "),t("code",[s._v("Build()")]),s._v(" æ–¹æ³•çš„æŒç»­æ—¶é—´å†…å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ "),t("code",[s._v("DiagnosticListener")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœæœ‰ä»»ä½•ä¸œè¥¿æ­£åœ¨ä¾¦å¬ "),t("code",[s._v("Microsoft.Extensions.Hosting.HostBuilding")]),s._v(" äº‹ä»¶ï¼Œåˆ™ "),t("code",[s._v("HostBuilder")]),s._v(" ä¼šå°†è‡ªèº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¾¦å¬å™¨ã€‚")]),s._v(" "),t("li",[s._v("æ„å»ºä¸»æœºå®Œæˆåï¼Œåœ¨æ–¹æ³•è¿”å›ä¹‹å‰ï¼Œ"),t("code",[s._v("HostBuilder")]),s._v(" ä¼šæ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å†…å®¹æ­£åœ¨ä¾¦å¬ "),t("code",[s._v("Microsoft.Extensions.Hosting.HostBuilt")]),s._v(" äº‹ä»¶ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ–°æ„å»ºçš„ä¸»æœºå°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¾¦å¬å™¨ã€‚")])]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HostBuilder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token type-list"}},[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IHostBuilder")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("IHost")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" diagnosticListener "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("DiagnosticListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Microsoft.Extensions.Hosting"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")])]),s._v(" hostBuildingEventName "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostBuilding"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")])]),s._v(" hostBuiltEventName "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostBuilt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("IsEnabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("IsEnabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostBuildingEventName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostBuildingEventName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­£å¸¸æ„å»ºè¿‡ç¨‹")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("BuildHostConfiguration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateHostingEnvironment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateHostBuilderContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("BuildAppConfiguration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateServiceProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _appServices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetRequiredService")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("IHost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("IsEnabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("IsEnabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostBuiltEventName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            diagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostBuiltEventName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("æ·»åŠ è¿™äº› "),t("code",[s._v("DiagnosticSource")]),s._v(" äº‹ä»¶åœ¨ç”¨æˆ·åº”ç”¨ç¨‹åºä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„å®ç”¨æ€§ï¼Œå› ä¸ºåœ¨æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨æ˜¾ç„¶å·²ç»å¯ä»¥è®¿é—® "),t("code",[s._v("HostBuilder")]),s._v(" å’Œæ„å»ºçš„ "),t("code",[s._v("IHost")]),s._v("ã€‚å½“ä½ éœ€è¦ä½¿ç”¨åå°„è¿è¡Œåº”ç”¨æ—¶ï¼Œä¾‹å¦‚åœ¨ EF Core çš„å·¥å…·ä¸­ï¼Œäº‹ä»¶å°±ä¼šæ´¾ä¸Šç”¨åœºã€‚")]),s._v(" "),t("h2",{attrs:{id:"hostfactoryresolver-ä¸­çš„æ›´æ–°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hostfactoryresolver-ä¸­çš„æ›´æ–°"}},[s._v("#")]),s._v(" HostFactoryResolver ä¸­çš„æ›´æ–°")]),s._v(" "),t("p",[s._v("EF Core å·¥å…·æœ‰ä¸€ä¸ªéš¾åŠçš„å·¥ä½œã€‚ä»–ä»¬éœ€è¦èƒ½å¤Ÿä½¿ç”¨åº”ç”¨ç¨‹åºçš„é…ç½®ï¼ˆåŒ…æ‹¬è¿æ¥å­—ç¬¦ä¸²ã€DI æœåŠ¡é…ç½®å’Œæ•°æ®åº“æä¾›ç¨‹åºé…ç½®ï¼‰ï¼Œè€Œæ— éœ€å®é™…è¿è¡Œåº”ç”¨ç¨‹åºã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä»–ä»¬ä½¿ç”¨äº†ä¸€ä¸ª"),t("a",{attrs:{href:"https://github.com/dotnet/runtime/blob/v6.0.0-rc.1.21451.13/src/libraries/Microsoft.Extensions.HostFactoryResolver/src/HostFactoryResolver.cs",target:"_blank",rel:"noopener noreferrer"}},[s._v("åä¸º"),t("code",[s._v("HostFactoryResolver")]),s._v(" çš„å¸®åŠ©å™¨ç±»"),t("OutboundLink")],1),s._v("ã€‚")]),s._v(" "),t("p",[s._v("HostFactoryResolver ä½äº"),t("em",[s._v("æºåŒ…ä¸­")]),s._v("ï¼ˆå³æºä»£ç è¢«å¤åˆ¶å¹¶åŒ…å«åœ¨ä½¿ç”¨é¡¹ç›®ä¸­ï¼‰ï¼Œå¹¶æä¾›å¸®åŠ©ç¨‹åºï¼Œç”¨äºåœ¨ç¨‹åºé›†ä¸­æŸ¥æ‰¾ ASP.NET Core åº”ç”¨çš„ä¸€ä¸ªå·²çŸ¥å…¥å£ç‚¹ã€‚")]),s._v(" "),t("p",[s._v("åœ¨ .NET 6 ä¹‹å‰ï¼Œ"),t("code",[s._v("HostFactoryResolver")]),s._v(" ä¼šæŸ¥æ‰¾ä¸€ä¸ªåä¸ºä»¥ä¸‹é¡¹ä¹‹ä¸€çš„å…¥å£ç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("BuildWebHost")])]),s._v(" "),t("li",[t("code",[s._v("CreateWebHostBuilder")])]),s._v(" "),t("li",[t("code",[s._v("CreateHostBuilder")])])]),s._v(" "),t("p",[s._v("å¦‚æœå®ƒåœ¨ç¨‹åºé›†å…¥å£ç‚¹ç±»ï¼ˆå³ "),t("code",[s._v("Program")]),s._v("ï¼‰ä¸Šæ‰¾åˆ°å…·æœ‰æ‰€éœ€åç§°çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›æ­£ç¡®çš„ç±»å‹ï¼Œå¹¶é‡‡ç”¨ "),t("code",[s._v("string[]")]),s._v(" å‚æ•°ï¼Œåˆ™å®ƒå°†ä½¿ç”¨åå°„è°ƒç”¨æ­¤æ–¹æ³•ä»¥è·å– "),t("code",[s._v("IHostBuilder")]),s._v("ï¼ˆæˆ–ç±»ä¼¼ï¼‰å®ä¾‹ã€‚è¿™å°±æ˜¯ EF Core å·¥å…·èƒ½å¤Ÿä½¿ç”¨åº”ç”¨é…ç½®çš„æ–¹å¼ã€‚")]),s._v(" "),t("p",[s._v("åœ¨ .NET 6 ä¸­ï¼Œæ·»åŠ äº†ä½¿ç”¨æ–°çš„è¯Šæ–­æºäº‹ä»¶çš„æ–°è§£å†³æœºåˆ¶ã€‚ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº† "),t("code",[s._v("ResolveHostFactory")]),s._v(" æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ³¨é‡Šï¼Œå› ä¸ºå®ƒä»¬éå¸¸æœ‰å¯å‘æ€§ï¼š")]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ­¤å¸®åŠ©ç¨‹åºå°è£…äº†ä»¥ä¸‹å„é¡¹æ‰€éœ€çš„æ‰€æœ‰å¤æ‚é€»è¾‘ï¼š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šç¨‹åºé›†çš„å…¥å£ç‚¹ã€‚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. ç­‰å¾…è¯Šæ–­æºäº‹ä»¶è§¦å‘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. ä¸ºè°ƒç”¨æ–¹æä¾›æ‰§è¡Œé€»è¾‘ä»¥æ”¹å˜ IHostBuilder çš„æœºä¼š")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. è§£æåº”ç”¨ç¨‹åºçš„ IHost å®ä¾‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. å…è®¸è°ƒç”¨æ–¹ç¡®å®šå…¥å£ç‚¹æ˜¯å¦å·²å®Œæˆ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Func"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ResolveHostFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Assembly")]),s._v(" assembly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeSpan"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" waitTimeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bool")])]),s._v(" stopApplication "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" configureHostBuilder "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" entrypointCompleted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("assembly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EntryPoint "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°è¯•åŠ è½½æ‰˜ç®¡å¹¶æ£€æŸ¥ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿äº‹ä»¶ç”šè‡³æœ‰æœºä¼šè§¦å‘ï¼ˆå®ƒä»¬æ˜¯åœ¨ .NET >= 6 ä¸­æ·»åŠ çš„ï¼‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" hostingAssembly "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Assembly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Load")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Microsoft.Extensions.Hosting"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hostingAssembly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Version "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Version")]),s._v(" version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Major "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æˆ‘ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬> = 6ï¼Œå› æ­¤äº‹ä»¶å¯ä»¥è§¦å‘ã€‚å¦‚æœå®ƒä»¬æ²¡æœ‰è§¦å‘ï¼Œé‚£æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºæ²¡æœ‰ä½¿ç”¨æ‰˜ç®¡APIs")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŠ è½½æ‰©å±•ç¨‹åºé›†æ—¶å‡ºé”™ï¼Œè¿”å› nullã€‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" args "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("HostingListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        assembly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EntryPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        waitTimeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("??")]),s._v(" s_defaultWaitTimeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        stopApplication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        configureHostBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        entrypointCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("æ­¤æ–¹æ³•æ‰§è¡Œä¸€äº›åˆå§‹æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å¼•ç”¨äº† .NET 6+ ç‰ˆæœ¬çš„ "),t("code",[s._v("Microsoft.Extensions.Hosting")]),s._v(" ç¨‹åºé›†ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™åˆ›å»º "),t("code",[s._v("HostingListener")]),s._v(" çš„å®ä¾‹ï¼Œè¯¥å®ä¾‹æ˜¯ "),t("code",[s._v("HostFactoryResolver")]),s._v(" ä¸­çš„åµŒå¥—ç±»ï¼Œå¤§éƒ¨åˆ†å·¥ä½œéƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚")]),s._v(" "),t("p",[s._v("æ‚¨å¯ä»¥"),t("a",{attrs:{href:"https://github.com/dotnet/runtime/blob/v6.0.0-rc.1.21451.13/src/libraries/Microsoft.Extensions.HostFactoryResolver/src/HostFactoryResolver.cs#L172-L328",target:"_blank",rel:"noopener noreferrer"}},[s._v("åœ¨GitHubä¸Šçœ‹åˆ° "),t("code",[s._v("HostingListener")]),s._v(" çš„å®Œæ•´æºä»£ç "),t("OutboundLink")],1),s._v("ï¼Œä½†ç”±äºå®ƒæœ‰150è¡Œï¼Œæˆ‘å°†è®²è§£ä¸‹é¢çš„é‡è¦éƒ¨åˆ†ã€‚")]),s._v(" "),t("p",[s._v("å¤§éƒ¨åˆ†å·¥ä½œéƒ½åœ¨ "),t("code",[s._v("CreateHost()")]),s._v(" æ–¹æ³•ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤ä»£ç è´Ÿè´£ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("åˆ›å»º "),t("code",[s._v("DiagnosticListener")]),s._v(" è®¢é˜…ï¼Œæ–¹æ³•æ˜¯æ³¨å†Œ "),t("code",[s._v("HostingListener")]),s._v(" æœ¬èº«ä»¥æ¥æ”¶å›è°ƒã€‚æˆ‘ä»¬ç¨åå°†å¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚")]),s._v(" "),t("li",[s._v("åˆ›å»ºæ–°çº¿ç¨‹å¹¶å¯åŠ¨å…¥å£ç‚¹ã€‚è¿™å°†å¯åŠ¨åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå¹¶å‡å®šåœ¨æŸä¸ªæ—¶å€™æ‚¨çš„åº”ç”¨ç¨‹åºå°†è°ƒç”¨ "),t("code",[s._v("HostBuilder.Build()")])]),s._v(" "),t("li",[s._v("ç­‰å¾…3ä»¶äº‹æƒ…ä¹‹ä¸€å‘ç”Ÿï¼š\n"),t("ul",[t("li",[s._v("æˆ‘ä»¬çš„è¯Šæ–­ä¾¦å¬å™¨ä»£ç åœ¨å®Œæˆæ‰€æœ‰è®¾ç½®åä¼šæŠ›å‡º "),t("code",[s._v("StopTheHostException")]),s._v("ï¼ˆæˆ‘ä»¬å¾ˆå¿«å°±ä¼šä»‹ç»è¿™ä¸ªï¼‰")]),s._v(" "),t("li",[s._v("åº”ç”¨ç¨‹åºä¸­ä¼šå¼•å‘å…¶ä»–ä¸€äº›å¼‚å¸¸")]),s._v(" "),t("li",[s._v("åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶é—´å¤ªé•¿ï¼Œå› æ­¤ "),t("code",[s._v("CreateHost")]),s._v(" è¶…æ—¶ã€‚")])])]),s._v(" "),t("li",[s._v("å‘ç”Ÿä¸Šè¿°æƒ…å†µä¹‹ä¸€åï¼Œç»“æœå°†ä¼ æ’­ç»™è°ƒç”¨æ–¹ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆè¿™å°†æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºçš„"),t("code",[s._v("IHost")]),s._v("ï¼‰ï¼Œæˆ–è€…å°†å¼•å‘å¼‚å¸¸ï¼š")])]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskCompletionSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _hostTcs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MethodInfo")]),s._v(" _entryPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncLocal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("HostingListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _currentListener "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" _entrypointCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" subscription "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DiagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AllListeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Kick off the entry point on a new thread so we don't block the current one")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// in case we need to timeout the execution")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" thread "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" exception "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Set the async local to the instance of the HostingListener so we can filter events that")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// aren't scoped to this execution of the entry point.")]),s._v("\n            _currentListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")])]),s._v(" parameters "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _entryPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetParameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parameters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Length "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                _entryPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Empty")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                _entryPoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" _args "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Try to set an exception if the entry point returns gracefully, this will force")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// build to throw")]),s._v("\n            _hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrySetException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("InvalidOperationException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unable to build IHost"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TargetInvocationException")]),s._v(" tie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InnerException "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StopTheHostException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The host was stopped by our own logic")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TargetInvocationException")]),s._v(" tie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            exception "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InnerException "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("??")]),s._v(" tie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Another exception happened, propagate that to the caller")]),s._v("\n            _hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrySetException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            exception "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Another exception happened, propagate that to the caller")]),s._v("\n            _hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrySetException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Signal that the entry point is completed")]),s._v("\n            _entrypointCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?.")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exception"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Make sure this doesn't hang the process")]),s._v("\n        IsBackground "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Start the thread")]),s._v("\n    thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Wait before throwing an exception")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("_hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_waitTimeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("InvalidOperationException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unable to build IHost"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AggregateException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IsCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Lets this propagate out of the call to GetAwaiter().GetResult()")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" _hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetAwaiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br")])]),t("p",[s._v("ä»…å‡­æ­¤ä»£ç ï¼Œå°šä¸æ¸…æ¥š EF Core å·¥å…·å¦‚ä½•èƒ½å¤Ÿä¸ "),t("code",[s._v("IHostBuilder")]),s._v(" ç”Ÿæˆè¿‡ç¨‹æŒ‚é’©ï¼Œä¹Ÿä¸æ¸…æ¥šå®ƒä»¬å¦‚ä½•è®¿é—® "),t("code",[s._v("IHost")]),s._v("ã€‚ç­”æ¡ˆåœ¨äº "),t("code",[s._v("HostingListener")]),s._v(" æ”¶åˆ°çš„ "),t("code",[s._v("DiagnosticSource")]),s._v(" äº‹ä»¶ï¼Œè¿™è¦å½’åŠŸäºåœ¨å‰é¢çš„ä»£ç ä¸­è°ƒç”¨ "),t("code",[s._v("DiagnosticListener.AllListeners.Subscribe(this)")]),s._v("ã€‚")]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sealed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HostingListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token type-list"}},[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IObserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("DiagnosticListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IObserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("KeyValuePair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AsyncLocal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("HostingListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _currentListener "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OnNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DiagnosticListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_currentListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore events that aren't for this listener")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Microsoft.Extensions.Hosting"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            _disposable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OnCompleted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _disposable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?.")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Dispose")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("åˆå§‹åŒ–æ–°çš„è¯Šæ–­ä¾¦å¬å™¨æ—¶ï¼Œä¸»æœºä¾¦å¬å™¨ä¼šæ£€æŸ¥")]),s._v(" "),t("ol",[t("li",[s._v("æˆ‘ä»¬ä½äºåŒä¸€å¼‚æ­¥æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­ï¼ˆ"),t("a",{attrs:{href:"https://github.com/dotnet/aspnetcore/issues/33494",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä»¥é¿å…å¹¶å‘é—®é¢˜"),t("OutboundLink")],1),s._v("ï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å¿½ç•¥ä¾¦å¬å™¨ã€‚æˆ‘ä»¬ä¸ä¼šä»æ­¤ä¾¦å¬å™¨æ¥æ”¶ä»»ä½•äº‹ä»¶ã€‚")]),s._v(" "),t("li",[s._v('æ£€æŸ¥ä¾¦å¬å™¨æ˜¯å¦åä¸º "'),t("code",[s._v("Microsoft.Extensions.Hosting")]),s._v('"ï¼Œä»¥ä¾¿æˆ‘ä»¬ä»…è®¢é˜…æ¥è‡ª '),t("code",[s._v("HostingBuilder")]),s._v(" çš„äº‹ä»¶ã€‚")])]),s._v(" "),t("p",[s._v("è®¢é˜…æ‰˜ç®¡äº‹ä»¶ä¾¦å¬å™¨åï¼Œå½“ "),t("code",[s._v("HostBuilder")]),s._v(" è°ƒç”¨ "),t("code",[s._v("diagnosticListener.Write()")]),s._v(" æ—¶ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°äº‹ä»¶ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨æœ¬æ–‡å‰é¢çœ‹åˆ°çš„é‚£æ ·ã€‚"),t("code",[s._v("OnNext()")]),s._v(" æ–¹æ³•æ˜¯ä½¿ç”¨ "),t("code",[s._v("KeyValuePair")]),s._v(" è°ƒç”¨çš„ï¼Œè¯¥æ–¹æ³•åŒ…å«äº‹ä»¶çš„åç§°å’Œå†™å…¥çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯ "),t("code",[s._v("HostisterListener")]),s._v(" å¯ä»¥è®¿é—® "),t("code",[s._v("IHostBuilder")]),s._v(" å’Œ "),t("code",[s._v("IHost")]),s._v(" çš„æ–¹å¼ï¼"),t("code",[s._v("IHostBuilder")]),s._v(" æ˜¯åœ¨å®Œæˆæ„å»ºä¹‹å‰è‡ªå®šä¹‰çš„ï¼Œæœ€ç»ˆçš„ "),t("code",[s._v("IHost")]),s._v(" å¯¹è±¡é€šè¿‡åœ¨ "),t("code",[s._v("TaskCompletionSource")]),s._v(" ä¸Šè®¾ç½®ç»“æœè€Œä¼ é€’å› EF Core å·¥å…·")]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bool")])]),s._v(" _stopApplication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TaskCompletionSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" _hostTcs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Action"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")])]),s._v(" _configure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OnNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyValuePair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_currentListener"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Ignore events that aren't for this listener")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostBuilding"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// run the action to customise the IHostBuilder passed in value.Value")]),s._v("\n        _configure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?.")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostBuilt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// store the IHost passed in value.Value")]),s._v("\n        _hostTcs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrySetResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The EF Core tools don't actually want to _run_ the application")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_stopApplication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Stop the host from running further")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("StopTheHostException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sealed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StopTheHostException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token type-list"}},[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("ä¸ºäº†é˜²æ­¢åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œåœ¨ç«¯å£ä¸Šä¾¦å¬ï¼‰ï¼Œä¾¦å¬å™¨ä¼šå¼•å‘ "),t("code",[s._v("StopTheHostException")]),s._v("ã€‚å½“ä¾¦å¬å™¨åœ¨åº”ç”¨ç¨‹åºä¸­ä»¥å†…è”æ–¹å¼è¿è¡Œæ—¶ï¼Œè¿™å®é™…ä¸Šä¼šä»æ­£åœ¨è¿è¡Œçš„åº”ç”¨ä¸­è§£è„±å‡ºæ¥ã€‚"),t("code",[s._v("HostingListener")]),s._v(" æ•è·æ­¤å¼‚å¸¸ï¼Œä¿ç•™ "),t("code",[s._v("IServiceProvider")]),s._v("ï¼Œå¹¶ç»§ç»­ä¸ä»¥å‰ç‰ˆæœ¬çš„æ¡†æ¶ä¸€æ ·ã€‚")]),s._v(" "),t("p",[s._v("é€šè¿‡è¿™äº›æ›´æ”¹ï¼ŒEF Core å·¥å…·èƒ½å¤Ÿå†æ¬¡æ£€ç´¢åº”ç”¨ç¨‹åºçš„ "),t("code",[s._v("IServiceProvider")]),s._v(" çš„å®ä¾‹ï¼ŒåŸºæœ¬ä¸Šè¿è¡Œæ‚¨çš„ "),t("code",[s._v("Program.Main")]),s._v(" å¹¶åœ¨æ„å»º "),t("code",[s._v("IHost")]),s._v(" åè¿›è¡Œæ•‘åŠ©ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:n(472),alt:"The EF Core tools run your Program.Main() and the diagnostic listener retrieves the IHost"}})]),s._v(" "),t("p",[s._v("æ„Ÿè§‰å®ƒåœ¨æŸç§ç¨‹åº¦ä¸Šæ»¥ç”¨äº†è¯Šæ–­æºï¼Œä½†å®ƒæœ‰æ•ˆï¼")]),s._v(" "),t("h2",{attrs:{id:"æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æè¿°äº†EF Coreå·¥å…·å¦‚ä½•ä¸æ–°çš„æœ€å°æ‰˜ç®¡ "),t("code",[s._v("WebApplicationBuilder")]),s._v(" å’Œ"),t("code",[s._v("WebApplication")]),s._v(" ä¸€èµ·å·¥ä½œã€‚ä½¿ç”¨è¿™äº›ç±»å‹å’Œé¡¶çº§ç¨‹åºï¼Œä»¥å‰ç”¨äºä¸ºåº”ç”¨åŠ è½½ "),t("code",[s._v("IServiceProvider")]),s._v(" çš„ EF Core åŸºäºçº¦å®šçš„æ–¹æ³•å°†ä¸å†æœ‰æ•ˆã€‚")]),s._v(" "),t("p",[s._v("è‹¥è¦è§£å†³è¿™äº›æ›´æ”¹ï¼Œå·²å°†æ–°çš„è¯Šæ–­æºäº‹ä»¶æ·»åŠ åˆ°ä¸»æœºç”Ÿæˆå™¨ã€‚è¿™äº›äº‹ä»¶å…è®¸è®¢é˜…è€…åœ¨æ„å»º "),t("code",[s._v("HostBuilder")]),s._v(" ä¹‹å‰è®¿é—®å®ƒï¼Œä»¥åŠåœ¨æ„å»ºåç«‹å³è®¿é—® "),t("code",[s._v("IHost")]),s._v(" å®ä¾‹ã€‚")]),s._v(" "),t("p",[s._v("EF Core å·¥å…·ä½¿ç”¨è¿™äº›äº‹ä»¶æ¥è¿è¡Œåº”ç”¨ç¨‹åºå¹¶æ£€ç´¢ "),t("code",[s._v("IHost")]),s._v(" å®ä¾‹ï¼ˆä»¥åŠå…³è”çš„ "),t("code",[s._v("IServiceProvider")]),s._v("ï¼‰ã€‚ç„¶åï¼Œå®ƒä»¬ä¼šå¼•å‘å¼‚å¸¸ï¼Œä»¥ä¾¿ä½ çš„åº”ç”¨"),t("em",[s._v("å®é™…ä¸Š")]),s._v("ä¸ä¼šè¿è¡Œã€‚")]),s._v(" "),t("br"),s._v(" "),t("br"),s._v(" "),t("br"),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("ä½œè€…ï¼šGerry Ge")]),s._v(" "),t("p",[s._v("å‡ºå¤„ï¼šç¿»è¯‘è‡³ "),t("a",{attrs:{href:"https://andrewlock.net/exploring-dotnet-6-part-5-supporting-ef-core-tools-with-webapplicationbuilder/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Supporting EF Core migrations with WebApplicationBuilder"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("ç‰ˆæƒï¼šæœ¬ä½œå“é‡‡ç”¨ã€Œ"),t("a",{attrs:{href:"https://creativecommons.org/licenses/by-nc-sa/4.0/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…"),t("OutboundLink")],1),s._v("ã€è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("è½¬è½½è¯·æ³¨æ˜å‡ºå¤„")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);